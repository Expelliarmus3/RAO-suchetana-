{% extends "layout.html" %}

{% block content %}
<style>
    /* --- 1. GLOBAL BACKGROUND STYLES --- */
    body {
        background-color: #f8fafc; /* Light base */
        background-image: 
            radial-gradient(#cbd5e1 1px, transparent 1px), /* Original Grid */
            radial-gradient(rgba(167, 139, 250, 0.2) 1.5px, transparent 1.5px), /* Cute Purple Dot */
            radial-gradient(rgba(34, 211, 238, 0.2) 1.5px, transparent 1.5px), /* Cute Cyan Dot */
            radial-gradient(rgba(244, 114, 182, 0.2) 1.5px, transparent 1.5px); /* Cute Pink Dot */
        
        background-size: 30px 30px, 90px 90px, 130px 130px, 170px 170px;
        background-position: 0 0, 20px 20px, 60px 80px, 100px 40px;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    .blob {
        position: absolute; filter: blur(80px); z-index: -1; opacity: 0.6;
        animation: float 10s infinite alternate ease-in-out;
    }
    .blob-1 { width: 400px; height: 400px; background: #a78bfa; top: -100px; left: -100px; }
    .blob-2 { width: 350px; height: 350px; background: #22d3ee; top: 200px; right: -50px; animation-delay: -5s; }

    @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(40px, 40px); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .fade-in { animation: slideUp 0.6s ease-out forwards; position: relative; z-index: 1; }

    /* --- NEW: APPLICATIONS TRACKER UNDER NAVBAR --- */
    .apps-tracker {
        max-width: 900px; margin: 20px auto 40px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border-radius: 24px; padding: 20px;
        border: 1px solid white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.03);
    }

    .app-mini-card {
        background: white; border-radius: 16px; padding: 12px 20px;
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: 10px; border: 1px solid #f1f5f9;
        transition: 0.2s;
    }
    .app-mini-card:hover { transform: scale(1.01); border-color: #e2e8f0; }

    .status-pill {
        padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase;
    }
    .status-selected { background: #dcfce7; color: #166534; }
    .status-pending { background: #fef3c7; color: #92400e; }

    /* --- 2. HERO & TYPOGRAPHY --- */
    .hero-box { text-align: center; margin-top: 30px; margin-bottom: 50px; }
    
    .gradient-text {
        background: linear-gradient(135deg, #1e293b 0%, #4f46e5 100%);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;
    }
    
    .hero-title { font-size: 48px; font-weight: 800; color: #0f172a; margin-bottom: 15px; line-height: 1.1; letter-spacing: -1px; }

    /* --- 3. COOL GLASS SEARCH BAR --- */
    .search-wrap { 
        background: rgba(255, 255, 255, 0.85); /* Glass Effect */
        backdrop-filter: blur(12px);
        padding: 10px; 
        border-radius: 20px; 
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.05); 
        border: 2px solid white; 
        display: flex; align-items: center; 
        max-width: 750px; margin: 0 auto; 
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        position: relative;
    }
    
    .search-wrap:hover { transform: translateY(-3px); box-shadow: 0 25px 60px rgba(0, 0, 0, 0.08); }

    .search-wrap:focus-within {
        transform: translateY(-3px);
        box-shadow: 0 30px 70px rgba(79, 70, 229, 0.2);
        border-color: #818cf8; /* Purple Glow Border */
    }
    
    .search-wrap input { 
        flex: 1; border: none; padding: 15px 25px; font-size: 16px; 
        outline: none; background: transparent; color: #0f172a; font-weight: 500;
    }
    .search-wrap input::placeholder { color: #94a3b8; font-weight: 400; }
    
    .btn-optimize {
        background: #0f172a; color: white; border: none; padding: 14px 28px; 
        border-radius: 14px; font-weight: 600; cursor: pointer; transition: 0.3s;
        display: flex; align-items: center; gap: 8px; box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15);
    }
    .btn-optimize:hover { background: #4f46e5; transform: scale(1.05); }

    /* --- 4. FEATURE CARDS --- */
    .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 900px; margin: 50px auto; }
    .feature-card { 
        background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
        padding: 30px; border-radius: 20px; border: 1px solid white; 
        transition: 0.3s; text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.02);
    }
    .feature-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.05); border-color: #e2e8f0; }
    .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 20px; }

    /* --- 5. RESULTS GRID --- */
    .res-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px; margin-top: 40px; text-align: left; animation: slideUp 0.5s ease-out; }
    .res-card { 
        background: white; border: 1px solid #e2e8f0; border-radius: 20px; 
        padding: 30px; box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05); 
    }
    
    .meta-item { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding: 12px 0; font-size: 14px; }
    .skill-tag { background: #eef2ff; color: #4f46e5; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; display: inline-block; margin: 4px 2px; border: 1px solid #c7d2fe; }

    /* Textarea Styling */
    textarea {
        width: 100%; height: 450px; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0;
        font-family: 'Plus Jakarta Sans', sans-serif; color: #334155; font-size: 14px; line-height: 1.8;
        resize: none; outline: none; background: #f8fafc; transition: 0.2s;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
    }
    textarea:focus { background: white; border-color: #6366f1; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }

    /* --- 6. RESUME UPLOAD BOX --- */
    .upload-area {
        border: 2px dashed #cbd5e1; border-radius: 16px; padding: 30px;
        text-align: center; background: #f8fafc; cursor: pointer; position: relative;
        transition: 0.2s; margin-bottom: 15px;
    }
    .upload-area:hover { border-color: #6366f1; background: #eef2ff; }
    .upload-area input { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
    .upload-icon { font-size: 32px; color: #6366f1; margin-bottom: 10px; }
    .upload-label { font-size: 14px; font-weight: 700; color: #475569; }

</style>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>

<div class="fade-in">

    <div class="apps-tracker">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 10px;">
            <h5 style="margin: 0; font-weight: 800; color: #0f172a; font-size: 16px;"><i class="fa-solid fa-list-check" style="color:#6366f1;"></i> My Applications</h5>
            <a href="/my_applications" style="font-size: 12px; font-weight: 700; color: #6366f1; text-decoration: none;">View All <i class="fa-solid fa-arrow-right"></i></a>
        </div>
        
        {% if applications %}
            {% for app in applications[:2] %} <div class="app-mini-card">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="width: 40px; height: 40px; background: #f8fafc; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #6366f1;">
                        <i class="fa-solid fa-file-alt"></i>
                    </div>
                    <div>
                        <div style="font-size: 14px; font-weight: 700; color: #1e293b;">{{ app.internship.title if app.internship else "External Research" }}</div>
                        <div style="font-size: 11px; color: #94a3b8;">Applied on {{ app.status_date if app.status_date else 'Recent' }}</div>
                    </div>
                </div>
                <span class="status-pill {{ 'status-selected' if app.status == 'Selected' else 'status-pending' }}">
                    {{ 'Selected' if app.status == 'Selected' else 'Pending' }}
                </span>
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #94a3b8; font-size: 13px; margin: 20px 0;">You haven't applied to anything yet.</p>
        {% endif %}
    </div>

Â  Â  <div class="hero-box">
Â  Â  Â  Â  <div style="margin-bottom: 20px;">
Â  Â  Â  Â  Â  Â  <span style="background: white; color: #6366f1; padding: 8px 16px; border-radius: 30px; font-size: 11px; font-weight: 800; letter-spacing: 1px; border: 1px solid #e0e7ff; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">âœ¨ AI POWERED </span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <h1 class="hero-title">Research Application <span class="gradient-text">Optimizer</span></h1>
Â  Â  Â  Â  <p style="color:#64748b; font-size:18px; margin-bottom:50px; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6;">
Â  Â  Â  Â  Â  Â  Turn complex research papers into hyper-personalized internship applications in seconds.
Â  Â  Â  Â  </p>

Â  Â  Â  Â  <div class="search-wrap">
Â  Â  Â  Â  Â  Â  <span style="padding-left: 20px; color: #6366f1; font-size: 18px;"><i class="fa-solid fa-link"></i></span>
Â  Â  Â  Â  Â  Â  <input type="text" id="paperUrl" placeholder="Paste Research Paper Link (arXiv, Semantic Scholar)...">
Â  Â  Â  Â  Â  Â  <button onclick="runOptimizer()" class="btn-optimize" id="opt-btn">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-solid fa-wand-magic-sparkles"></i> Optimize
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="featuresArea" class="features-grid">
Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  <div class="icon-box" style="background: #eff6ff; color: #3b82f6;"><i class="fa-solid fa-robot"></i></div>
Â  Â  Â  Â  Â  Â  <h3 style="font-size: 18px; margin-bottom: 8px; font-weight: 700;">AI Summarizer</h3>
Â  Â  Â  Â  Â  Â  <p style="font-size: 14px; color: #64748b; line-height: 1.6;">Instantly extracts key topics and methods from complex PDFs.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  <div class="icon-box" style="background: #f0fdf4; color: #16a34a;"><i class="fa-solid fa-check-double"></i></div>
Â  Â  Â  Â  Â  Â  <h3 style="font-size: 18px; margin-bottom: 8px; font-weight: 700;">Skill Matching</h3>
Â  Â  Â  Â  Â  Â  <p style="font-size: 14px; color: #64748b; line-height: 1.6;">Identifies technical gaps between your resume and the paper.</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="feature-card">
Â  Â  Â  Â  Â  Â  <div class="icon-box" style="background: #f5f3ff; color: #7c3aed;"><i class="fa-solid fa-envelope-open-text"></i></div>
Â  Â  Â  Â  Â  Â  <h3 style="font-size: 18px; margin-bottom: 8px; font-weight: 700;">Smart Drafting</h3>
Â  Â  Â  Â  Â  Â  <p style="font-size: 14px; color: #64748b; line-height: 1.6;">Writes professional, context-aware applications to professors.</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="result-area" class="res-grid" style="display:none;">
Â  Â  Â  Â  
Â  Â  Â  Â  <div class="res-card">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="font-size:20px; color:#0f172a; font-weight: 700;"><i class="fa-solid fa-file-pen" style="color: #6366f1; margin-right: 8px;"></i> Generated Draft</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:12px; color:#64748b; background:#f1f5f9; padding:6px 12px; border-radius:8px; font-weight: 600;">Editable Mode</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <textarea id="app-text"></textarea>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="display:flex; flex-direction:column; gap:25px;">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="res-card" style="padding: 30px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="meta-item"><span style="color:#64748b; font-weight:600;">Citation Score</span><span id="cit-score" style="color:#0f172a; font-weight:800;">-</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="meta-item"><span style="color:#64748b; font-weight:600;">Est. Vacancies</span><span id="vacancies" style="color:#0f172a; font-weight:800;">-</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="meta-item" style="border:none;"><span style="color:#64748b; font-weight:600;">Competition</span><span id="applicants" style="color:#0f172a; font-weight:800;">-</span></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="res-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-bottom:15px; font-size:16px; color:#0f172a; font-weight: 700;">ðŸ“„ Quick Summary</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="paper-summary" style="font-size:14px; color:#475569; line-height:1.7;">...</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="res-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-bottom:15px; font-size:16px; color:#0f172a; font-weight: 700;">âš¡ Required Skills</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="skills-container"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="res-card">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-bottom:15px; font-size:16px; color:#0f172a; font-weight: 700;">ðŸ“Ž Attach Resume</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <form id="appForm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-area" id="drop-zone">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-label" id="file-label">Click to Upload PDF</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="resumeFile" name="resume" accept=".pdf" onchange="updateFileName()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="submitApp()" id="btn-apply" style="width:100%; background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); color:white; padding:18px; border-radius:12px; border:none; font-weight:700; cursor:pointer; font-size:16px; transition: transform 0.2s; box-shadow: 0 10px 20px rgba(22, 163, 74, 0.2);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Apply Now <i class="fa-solid fa-paper-plane" style="margin-left:8px;"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
Â  Â  async function runOptimizer() {
Â  Â  Â  Â  const btn = document.getElementById('opt-btn');
Â  Â  Â  Â  const resultArea = document.getElementById('result-area');
Â  Â  Â  Â  const featuresArea = document.getElementById('featuresArea'); 
Â  Â  Â  Â  
Â  Â  Â  Â  // Loading State
Â  Â  Â  Â  btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Processing...';
Â  Â  Â  Â  btn.style.opacity = "0.7";
Â  Â  Â  Â  
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const url = document.getElementById('paperUrl').value;
Â  Â  Â  Â  Â  Â  if(!url) { alert("Please enter a URL!"); btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Optimize'; btn.style.opacity = "1"; return; }

Â  Â  Â  Â  Â  Â  const response = await fetch('/optimize', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: {'Content-Type': 'application/json'},
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({url: url})
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if(data.error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â alert("Error: " + data.error);
Â  Â  Â  Â  Â  Â  Â  Â  Â btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Optimize';
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // FILL DATA
Â  Â  Â  Â  Â  Â  document.getElementById('app-text').value = data.application;
Â  Â  Â  Â  Â  Â  document.getElementById('cit-score').innerText = data.analysis.citation_score;
Â  Â  Â  Â  Â  Â  document.getElementById('vacancies').innerText = data.analysis.vacancies;
Â  Â  Â  Â  Â  Â  document.getElementById('applicants').innerText = data.analysis.applicants;
Â  Â  Â  Â  Â  Â  document.getElementById('paper-summary').innerText = data.analysis.summary;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const skillsDiv = document.getElementById('skills-container');
Â  Â  Â  Â  Â  Â  skillsDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  data.analysis.skills.forEach(skill => {
Â  Â  Â  Â  Â  Â  Â  Â  skillsDiv.innerHTML += `<span class="skill-tag">${skill}</span>`;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // SWITCH VIEW
Â  Â  Â  Â  Â  Â  featuresArea.style.display = 'none';
Â  Â  Â  Â  Â  Â  resultArea.style.display = 'grid';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Reset Button
Â  Â  Â  Â  Â  Â  btn.innerHTML = '<i class="fa-solid fa-check"></i> Done';
Â  Â  Â  Â  Â  Â  btn.style.background = "#16a34a"; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Optimize';
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.background = "#0f172a";
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.opacity = "1";
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error(error);
Â  Â  Â  Â  Â  Â  alert("Error fetching data. Check console.");
Â  Â  Â  Â  Â  Â  btn.innerHTML = 'Retry';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateFileName() {
Â  Â  Â  Â  const input = document.getElementById('resumeFile');
Â  Â  Â  Â  const label = document.getElementById('file-label');
Â  Â  Â  Â  if(input.files && input.files[0]) {
Â  Â  Â  Â  Â  Â  label.innerText = input.files[0].name;
Â  Â  Â  Â  Â  Â  label.style.color = "#16a34a"; 
Â  Â  Â  Â  Â  Â  label.style.fontWeight = "700";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function submitApp() {
Â  Â  Â  Â  const fileInput = document.getElementById('resumeFile');
Â  Â  Â  Â  const textInput = document.getElementById('app-text'); 
Â  Â  Â  Â  const btn = document.getElementById('btn-apply');

Â  Â  Â  Â  if (!fileInput.files[0]) { alert("Please attach your resume first!"); return; }
Â  Â  Â  Â  if (!textInput.value) { alert("Please generate or write an email first!"); return; }

Â  Â  Â  Â  btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Sending...';

Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  formData.append('resume', fileInput.files[0]);
Â  Â  Â  Â  formData.append('cover_letter', textInput.value); 

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch('/submit_application', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if(data.status === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = '<i class="fa-solid fa-check"></i> Sent!';
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.background = "#059669";
Â  Â  Â  Â  Â  Â  Â  Â  alert("Success! The Professor can now view your Cover Letter and Resume.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  alert("Upload failed.");
Â  Â  Â  Â  Â  Â  btn.innerHTML = 'Retry';
Â  Â  Â  Â  }
Â  Â  }
</script>
{% endblock %}]